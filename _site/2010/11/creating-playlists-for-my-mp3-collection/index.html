


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    
  <title>Creating Playlists for my MP3 Collection - Random Thoughts and Geekery</title>

    
  <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="/feed" />
<link rel="alternate" type="application/atom+xml" title="Atom 1.0"
href="/feed/atom" />
<link rel="stylesheet" href="/css/reset.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="/css/style.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="/css/shCore.css" type="text/css" media="screen"/>
<link rel="stylesheet" href="/css/shThemeDefault.css" type="text/css" media="screen"/>

<script type="text/javascript" src="/js/shCore.js"></script>
<script type="text/javascript" src="/js/shBrushBash.js"></script>
<script type="text/javascript" src="/js/shBrushPerl.js"></script>
<script type="text/javascript" src="/js/shBrushPython.js"></script>
<script type="text/javascript" src="/js/shBrushSql.js"></script>
<script type="text/javascript">
SyntaxHighlighter.all()
</script>


  </head>
  <body>
    <div id="header">
        
  <h1><a href="/"><span style="color:#333333">Random <span style="color:#cc3333">Thoughts</span> and Geekery</span></a></h1>
<div id="description">by Ant Zucaro</div>


    </div> <!-- end header -->

    <div id="sidebar">
        
  <ul id="nav">
   <li><a href="/about.html">about</a></li>
   <li><a href="/family">family</a></li>
   <li><a href="/photography">photography</a></li>
   <li><a href="/archive">archive</a></li>
   <li><a href="/feed">feed</a></li>
</ul>


    </div> <!-- end sidebar -->

    <div id="main">
        

<div class="blog_post">
  <a name="creating-playlists-for-my-mp3-collection"></a>
  <h2 class="blog_post_title"><a href="/2010/11/creating-playlists-for-my-mp3-collection/" rel="bookmark" title="Permanent Link to Creating Playlists for my MP3 Collection">Creating Playlists for my MP3 Collection</a></h2>
  <div class="timestamp">
     <small>November 07, 2010 at 11:26 AM in 

<a href='/category/blog'>blog</a>, <a href='/category/geekery'>geekery</a>
   </div> <!-- end timestamp and categories -->
</small><p/>
  <div class="post_prose">
    
  <p>As I've mentioned <a href="http://www.antzucaro.com/2010/11/abcde-a-better-cd-encoder/">before</a>, about two summers back I went through my whole CD collection and digitized it to MP3 format using a tool called ABCDE. What I didn't mention in that post was that at the time I'd forgotten to create playlists automatically during the process. Bummer! I had all of these albums digitized, but whenever I wanted to play a particular album I'd have to add the folder through my music player or manually select all of the files to add to my playlist. That wasn't too bad, but if you've had any experience with playlists in Windows Media Player, VLC, or even XMMS you'll know that in practice it is just a pain to handle. For whatever reason it may be, the ordering of the album tracks on the playlist <em><strong>always</strong></em> gets messed up when adding manually or via folders. <em><strong>Always!</strong></em> Now, I know I can fix this simply by sorting by the ID3 metadata (click the "track number" column in most players to sort), but the point is that <em>I shouldn't have to do this</em>. I wanted a simple solution.</p>
<p>I get annoyed with these things pretty quickly, so I started thinking about how I could remedy the situation to save myself some time. Obviously I could investigate <em>why </em>each of the players were failing to sort my properly named (and usually tagged) files, but that seemed like too much work. I thought a simple solution would be to create M3U (a <a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBwQFjAA&amp;url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FM3U&amp;rct=j&amp;q=m3u&amp;ei=sMnWTOWRFMP-8AaXnPmZBg&amp;usg=AFQjCNHVxaaNTKNnCiADQmd33edsMs0o4A&amp;sig2=OU39DvcsU8FPv3XmFXfiiQ&amp;cad=rja">standard</a> playlist format) playlist files in each album directory that would contain the exact track ordering of that particular album. That way to play an album all I'd need to do was double click on the playlist file and <em>voila!</em> it would play it in the right order. This would also give me the ability to drag and drop multiple albums without having to worry about sort issues with having multiple track 1s (not too much of a problem with today's players, but still).</p>
<p>I did a little research and found a tool to help me write the playlists. It's a Python library called <a href="http://www.google.com/url?sa=t&amp;source=web&amp;cd=1&amp;ved=0CBkQFjAA&amp;url=http%3A%2F%2Fcode.google.com%2Fp%2Fmutagen%2F&amp;rct=j&amp;q=mutagen&amp;ei=FsvWTPb9IoT48AblrMjYDA&amp;usg=AFQjCNHzts_jR6qh9C_NtJi1COJQEfqHWQ&amp;sig2=eoawYstMNOwkQafn61uG1g&amp;cad=rja">mutagen</a>, and it basically allowed me to programmatically read the metadata of Mp3 files to get the following information (among the many other things it can retrieve):
<ul>
    <li>Track number</li>
    <li>Artist name</li>
    <li>Album name</li>
    <li>Track length (seconds)</li>
</ul>
After installing mutagen, I wrote the following Python script (m3u.py) to traverse through a set of directories and create playlist files at the lowest level. For example, if I ran it on <em>/home/ant/Music/Coldplay/Parachutes</em> I would end up with a playlist file inside the <em>Parachutes</em> directory:</p>
<p>[python]</p>
<h1>!/usr/bin/python</h1>
<p>import os
import sys
import glob
from mutagen.mp3 import MP3
from mutagen.easyid3 import EasyID3</p>
<p>def makem3u(dir=&quot;.&quot;):
    try:
        print &quot;Processing directory '%s'.&quot; % dir
        os.chdir(dir)</p>
<pre><code>    # get ID3 meta objects for each mp3,
    # store in a list
    playlist = ''
    mp3s = []
    for file in glob.glob(&amp;quot;*.[mM][pP]3&amp;quot;):
        if playlist == '':
            playlist = EasyID3(file)['album'][0] + '.m3u'
        meta_info = {
            'filename': file,
            'length': int(MP3(file).info.length),
            'tracknumber': EasyID3(file)['tracknumber'][0].split('/')[0],
        }
        mp3s.append(meta_info)

    if len(mp3s) &amp;gt; 0:
        print &amp;quot;Writing playlist %s.&amp;quot; % playlist

        # write the playlist
        of = open(playlist, 'w')
        of.write(&amp;quot;#EXTM3U\n&amp;quot;)

        # sorted by track number
        for mp3 in sorted(mp3s, key=lambda mp3: int(mp3['tracknumber'])):
            of.write(&amp;quot;#EXTINF:%s,%s\n&amp;quot; % (mp3['length'], mp3['filename']))
            of.write(mp3['filename'] + &amp;quot;\n&amp;quot;)

        of.close()

except:
    print &amp;quot;Error when trying to process directory '%s'. Ignoring...&amp;quot; % dir
    print &amp;quot;Text:&amp;quot;, sys.exc_info()[0]
</code></pre>
<p>def main(argv = None):
    if argv is None:
        argv = sys.argv</p>
<pre><code># directories containing music files
dirs = []

if len(sys.argv) == 2 and sys.argv[1] == '-':
# we do not have command line arguments,
# so read from STDIN
   for line in sys.stdin:
       dirs.append(line.strip())
else:
# passed in directories on the command line
    for dir in sys.argv[1:]:
        dirs.append(dir)

# for each directory passed to us, go
# to it and make the M3U out of the
# MP3 files there
for dir in dirs:
    makem3u(dir)

return 0
</code></pre>
<p>if <strong>name</strong> == &quot;<strong>main</strong>&quot;:
    sys.exit(main())
[/python]</p>
<p>You can pass directories two ways this script - as arguments or via standard input. This allows me to do this:</p>
<pre class="brush:bash;">m3u.py /home/ant/Music/Coldplay/Parachutes</pre>

<p>...or if I wanted to do a bunch of directories in bulk:</p>
<pre class="brush:bash;">find /home/ant/Music -type d -links 2 | m3u.py - </pre>

<p>Note that I made only a small attempt to make this script bulletproof. It gives a decent attempt to find the metadata in the MP3 files it finds in the directory, but if it encounters an error thrown by mutagen it dies out with an error message telling me the directory that failed and the exception it hit. Nine times out of ten (in my testing) the script will die because the tag information in the MP3s are malformed, which means that you wouldn't want to create a playlist off of them using that info anyway.</p>
<p>When I ran this script on the 127 albums on my laptop, I only had 12 fail (of course YMMV depending on how your collection is set up). A 90% success rate for me to avoid futzing w/ files in my media player is worth it! Plus, I had fun figuring out and learning something new in the process.</p>

  </div>
</div>





<div id="disqus_thread"></div>
<script type="text/javascript">
  var disqus_url = "http://www.antzucaro.com/2010/11/creating-playlists-for-my-mp3-collection/";
</script>
<script type="text/javascript" src="http://disqus.com/forums/antzucaro/embed.js"></script>
<noscript><a href="http://antzucaro.disqus.com/?url=ref">View the discussion thread.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>



    </div> <!-- end main -->

    <div id="footer">
        
  Copyright Â© 2009-2011 Ant Zucaro. Proudly powered by <a href="http://www.blogofile.com">Blogofile</a>.


    </div> <!-- end footer -->
  </body>
</html>







